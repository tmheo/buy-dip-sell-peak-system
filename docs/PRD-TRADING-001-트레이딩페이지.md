# PRD-TRADING-001: 트레이딩 페이지

## 1. 개요

### 1.1 문서 정보

- **문서 ID**: PRD-TRADING-001
- **버전**: 1.0.0
- **작성일**: 2026-01-23
- **상태**: Draft

### 1.2 배경

사용자가 트레이딩 계좌를 생성하고 관리할 수 있는 페이지를 개발합니다. 원본 사이트(떨사오팔 Pro)의 트레이딩 기능을 참고하되, 계좌 수 제한 제거 및 일부 기능 제외 등의 커스터마이징을 적용합니다.

### 1.3 목표

- 사용자별 무제한 트레이딩 계좌 생성 및 관리
- 실시간 자산 현황 및 보유 현황 조회
- 티어별 매수/매도 주문표 확인
- 설정 변경 (사이클 미진행 시에만)

---

## 2. 화면 구성

### 2.1 계좌 목록 화면 (`/trading`)

사용자의 모든 트레이딩 계좌를 테이블 형태로 표시합니다.

#### 테이블 컬럼

| 컬럼명 | 설명 | 비고 |
|--------|------|------|
| 순번 | 계좌 생성 순서 (1부터 시작) | 자동 부여 |
| 계좌 이름 | 사용자가 지정한 계좌 이름 | 아이콘 포함 가능 |
| 종목 | 거래 대상 티커 심볼 | SOXL, TQQQ |
| 시드 | 초기 투자금 (USD) | 달러 포맷 |
| 전략 | 적용 중인 전략 | Pro1, Pro2, Pro3 |
| 보유 | 현재 보유 티어 수 / 전체 티어 수 | 예: 0/6 |
| 시작일 | 사이클 시작일 | YYYY-MM-DD |
| 회차 | 현재 사이클 번호 | 자동 증가 |
| 작업 | 상세 보기 버튼 | "자세히" 버튼 |
| 삭제 | 계좌 삭제 버튼 | 확인 필요 |

#### 제외 항목

- ~~순서 변경 컬럼~~ (원본에 있으나 제외)
- ~~계좌 수 제한 표시~~ (1/10 → 숫자만 표시)

#### 하단 요소

- **계좌 수**: 현재 계좌 개수 표시 (예: "계좌 수: 3")
- **새 계좌 만들기**: 계좌 생성 화면으로 이동하는 버튼

---

### 2.2 계좌 생성 화면 (`/trading/new`)

새로운 트레이딩 계좌를 생성하는 폼 화면입니다.

#### 입력 필드

| 필드명 | 타입 | 필수 | 설명 | 기본값 |
|--------|------|------|------|--------|
| 계좌 이름 | Text | O | 계좌 식별용 이름 | - |
| 종목 | Select | O | 거래 대상 티커 | SOXL |
| 시드 자금($) | Number | O | 초기 투자금 (USD) | 2000 |
| 시작일 | Date | O | 사이클 시작일 | 오늘 날짜 |
| 전략 | Select | O | 적용할 전략 | Pro1 |

#### 종목 옵션

- SOXL (Direxion Daily Semiconductor Bull 3X)
- TQQQ (ProShares UltraPro QQQ)

#### 전략 옵션

- Pro1
- Pro2
- Pro3

#### 안내 문구

> *설정은 계좌 생성 후에도 변경할 수 있습니다.

#### 버튼

- **계좌 생성**: 폼 제출 및 계좌 생성

---

### 2.3 계좌 상세 화면 (`/trading/[accountId]`)

특정 계좌의 상세 정보와 현황을 표시합니다.

#### 2.3.1 상단 설정 영역

계좌의 기본 설정을 표시합니다.

| 항목 | 설명 | 편집 가능 |
|------|------|----------|
| 종목(Ticker) | 거래 대상 티커 | 사이클 미진행 시 |
| 시드($) | 초기 투자금 | 사이클 미진행 시 |
| 전략 | 적용 중인 전략 | 사이클 미진행 시 |
| 사이클 시작일 | 현재 사이클의 시작일 | 사이클 미진행 시 |
| 회차(Cycle) | 현재 사이클 번호 | 읽기 전용 |

**버튼**:
- **설정 변경**: 편집 모드로 전환 (사이클 미진행 시에만 활성화)
- ~~새로 시작~~ (제외)

#### 2.3.2 자산 현황 섹션

계좌의 전체 자산 상태를 요약합니다.

| 항목 | 설명 |
|------|------|
| 총자산 | 예수금 + 종목 평가금 |
| 종목 수량 | 보유 중인 총 주식 수 |
| 종목 평가금 | 보유 주식의 현재 평가 금액 (수익률 포함) |
| 예수금 | 현재 현금 잔액 |
| 투자비중 | 현금 vs 주식 비중 (프로그레스 바) |

#### 2.3.3 보유 현황 섹션

티어별 보유 상태를 테이블로 표시합니다.

| 컬럼 | 설명 |
|------|------|
| 티어 | 티어 번호 (1-6, 7=예비티어) |
| 비율 | 해당 티어의 시드 할당 비율 |
| 할당 시드 | 해당 티어에 할당된 금액 |
| 매수일 | 매수 체결일 (미보유 시 빈칸) |
| 매수시드 | 매수 시 사용된 금액 |
| 매수가격 | 매수 체결가 |
| 수량 | 보유 주식 수 (미보유 시 "-") |
| 매도목표 | 목표 매도가 |
| 보유기간 | 매수 후 경과일 |

**티어 비율 (Pro 전략 기준)**:
- 티어 1: 10%
- 티어 2: 15%
- 티어 3: 20%
- 티어 4: 25%
- 티어 5: 20%
- 티어 6: 10%
- 예비티어: 별도 할당 없음

#### 2.3.4 오늘의 주문표 섹션

당일 예정된 주문을 테이블로 표시합니다.

| 컬럼 | 설명 |
|------|------|
| 종목 | 티커 심볼 |
| 티어 | 대상 티어 번호 |
| 구분 | 매수/매도 |
| 주문방법 | LOC/MOC |
| 주문가 | 지정가 |
| 수량 | 주문 수량 |

**갱신 주기**: 매일 AM 9시~10시 갱신

---

### 2.4 설정 변경 모드

계좌 상세 화면에서 "설정 변경" 버튼 클릭 시 활성화됩니다.

#### 활성화 조건

- **보유 수량 = 0**: 설정 변경 가능
- **보유 수량 > 0**: 설정 변경 불가 (사이클 진행 중)

#### 편집 가능 필드

| 필드 | 입력 타입 |
|------|----------|
| 종목(Ticker) | Dropdown (SOXL, TQQQ) |
| 시드($) | Number input |
| 전략 | Dropdown (Pro1, Pro2, Pro3) |
| 사이클 시작일 | Date picker |

#### 버튼

- **저장**: 변경사항 저장
- **취소**: 편집 모드 종료 (변경사항 취소)

---

## 3. 기능 요구사항

### 3.1 계좌 관리

| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-001 | 사용자는 무제한으로 트레이딩 계좌를 생성할 수 있다 | P0 |
| FR-002 | 사용자는 계좌 이름, 종목, 시드, 시작일, 전략을 지정하여 계좌를 생성할 수 있다 | P0 |
| FR-003 | 사용자는 계좌 목록에서 모든 계좌를 조회할 수 있다 | P0 |
| FR-004 | 사용자는 계좌를 삭제할 수 있다 (확인 절차 필요) | P0 |
| FR-005 | 사용자는 사이클 미진행 상태에서만 설정을 변경할 수 있다 | P0 |

### 3.2 사이클 관리

| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-010 | 사이클은 첫 매수 체결 시 시작된다 | P0 |
| FR-011 | 사이클은 모든 티어가 매도 완료되면 종료된다 | P0 |
| FR-012 | 사이클 종료 시 회차(Cycle)가 자동으로 1 증가한다 | P0 |
| FR-013 | 보유 수량 > 0이면 사이클 진행 중으로 판단한다 | P0 |

### 3.3 자산 현황

| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-020 | 총자산 = 예수금 + 종목 평가금으로 계산한다 | P0 |
| FR-021 | 종목 평가금 = 보유 수량 × 현재가로 계산한다 | P0 |
| FR-022 | 투자비중은 (현금 / 주식) 비율로 시각화한다 | P1 |

### 3.4 보유 현황

| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-030 | 티어별 보유 상태를 테이블로 표시한다 | P0 |
| FR-031 | 미보유 티어는 수량을 "-"로 표시한다 | P0 |
| FR-032 | 보유 기간은 매수일로부터 경과일을 계산하여 표시한다 | P1 |

### 3.5 주문표

| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-040 | 당일 예정된 매수/매도 주문을 표시한다 | P0 |
| FR-041 | 주문은 LOC(Limit on Close) 방식으로 계산한다 | P0 |
| FR-042 | 주문표는 매일 AM 9시~10시에 갱신된다 | P1 |

---

## 4. 비즈니스 규칙

### 4.1 사이클 진행 중 판단

```
IF 보유 수량 > 0 THEN
  사이클 진행 중 = TRUE
  설정 변경 = 불가
ELSE
  사이클 진행 중 = FALSE
  설정 변경 = 가능
END IF
```

### 4.2 회차 자동 증가

```
IF 사이클 종료 (모든 티어 매도 완료) THEN
  회차 = 회차 + 1
  사이클 시작일 = 유지 또는 사용자 변경 가능
END IF
```

### 4.3 티어 비율 (전략별)

| 티어 | Pro1 | Pro2 | Pro3 |
|------|------|------|------|
| 1 | 10% | 10% | 10% |
| 2 | 15% | 15% | 15% |
| 3 | 20% | 20% | 20% |
| 4 | 25% | 25% | 25% |
| 5 | 20% | 20% | 20% |
| 6 | 10% | 10% | 10% |

> 참고: 전략별 비율은 동일하나, 매수/매도 임계값이 다름

---

## 5. 데이터 모델

### 5.1 Trading Account (새로 추가)

```typescript
interface TradingAccount {
  id: string;                    // UUID
  userId: string;                // 사용자 ID (users 테이블 참조)
  name: string;                  // 계좌 이름
  ticker: "SOXL" | "TQQQ";       // 종목
  seedCapital: number;           // 시드 자금 (USD)
  strategy: "Pro1" | "Pro2" | "Pro3"; // 전략
  cycleStartDate: string;        // 사이클 시작일 (YYYY-MM-DD)
  cycleNumber: number;           // 현재 사이클 번호
  createdAt: string;             // 생성일시
  updatedAt: string;             // 수정일시
}
```

### 5.2 Tier Holding (새로 추가)

```typescript
interface TierHolding {
  id: string;                    // UUID
  accountId: string;             // TradingAccount ID
  tier: number;                  // 티어 번호 (1-7)
  buyPrice: number | null;       // 매수 체결가
  shares: number;                // 보유 수량 (0이면 미보유)
  buyDate: string | null;        // 매수 체결일
  sellTargetPrice: number | null; // 매도 목표가
  createdAt: string;
  updatedAt: string;
}
```

### 5.3 Daily Order (새로 추가)

```typescript
interface DailyOrder {
  id: string;                    // UUID
  accountId: string;             // TradingAccount ID
  date: string;                  // 주문 날짜 (YYYY-MM-DD)
  tier: number;                  // 티어 번호
  type: "BUY" | "SELL";          // 주문 유형
  orderMethod: "LOC" | "MOC";    // 주문 방식
  limitPrice: number;            // 지정가
  shares: number;                // 주문 수량
  executed: boolean;             // 체결 여부
  createdAt: string;
  updatedAt: string;
}
```

---

## 6. API 엔드포인트

### 6.1 계좌 관리

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/trading/accounts` | 사용자의 모든 계좌 목록 조회 |
| GET | `/api/trading/accounts/[id]` | 특정 계좌 상세 조회 |
| POST | `/api/trading/accounts` | 새 계좌 생성 |
| PUT | `/api/trading/accounts/[id]` | 계좌 설정 수정 |
| DELETE | `/api/trading/accounts/[id]` | 계좌 삭제 |

### 6.2 보유 현황

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/trading/accounts/[id]/holdings` | 티어별 보유 현황 조회 |

### 6.3 주문표

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/trading/accounts/[id]/orders` | 당일 주문표 조회 |

---

## 7. UI/UX 고려사항

### 7.1 접근 제한

- 로그인된 사용자만 트레이딩 페이지 접근 가능
- 본인의 계좌만 조회/수정/삭제 가능

### 7.2 반응형 디자인

- 데스크톱: 전체 테이블 표시
- 모바일: 카드형 레이아웃 또는 가로 스크롤

### 7.3 색상 테마

- 매수: 빨간색 (#d73a49)
- 매도: 파란색 (#0366d6)
- 수익: 녹색 (+%)
- 손실: 빨간색 (-%)

### 7.4 로딩 상태

- 데이터 로딩 중 스켈레톤 UI 표시
- API 오류 시 재시도 버튼 표시

### 7.5 확인 절차

- 계좌 삭제 시 확인 모달 표시
- 설정 변경 저장 전 확인

---

## 8. 제외 기능

다음 기능은 이번 버전에서 제외합니다:

| 기능 | 이유 |
|------|------|
| 계좌 수 제한 | 무제한 허용 |
| 순서 변경 | 불필요 |
| 새로 시작 | 미구현 |
| 추천 전략 자동 토글 | 미구현 |

---

## 9. 향후 고려사항

- 텔레그램 연동 (추천 전략 알림)
- 수익률 차트
- 거래 히스토리
- 계좌별 백테스트 비교

---

## 10. 용어 정의

| 용어 | 정의 |
|------|------|
| 사이클 | 매수 시작부터 전량 매도 완료까지의 거래 단위 |
| 회차 | 사이클 완료 횟수 |
| 티어 | 분할 매수/매도 단계 (1-6, 7=예비) |
| LOC | Limit on Close - 종가 지정가 주문 |
| MOC | Market on Close - 종가 시장가 주문 |
| 시드 | 초기 투자 원금 |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0.0 | 2026-01-23 | 최초 작성 | Claude |
